(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{574:function(s,a,t){s.exports=t.p+"assets/img/20220120152206.abbc1cb0.jpg"},575:function(s,a,t){s.exports=t.p+"assets/img/20220120151855.aa510fb8.jpg"},576:function(s,a,t){s.exports=t.p+"assets/img/20220120152021.bb0fe753.jpg"},577:function(s,a,t){s.exports=t.p+"assets/img/20220120155104.c3d5af9d.jpg"},578:function(s,a,t){s.exports=t.p+"assets/img/20220120155358.9a016ba2.jpg"},579:function(s,a,t){s.exports=t.p+"assets/img/20220120150222.c3210efe.jpg"},580:function(s,a,t){s.exports=t.p+"assets/img/20220120150418.8803f5cb.jpg"},581:function(s,a,t){s.exports=t.p+"assets/img/20220120150504.6ebc1b95.jpg"},582:function(s,a,t){s.exports=t.p+"assets/img/20220120150559.d49d6171.jpg"},583:function(s,a,t){s.exports=t.p+"assets/img/20220120164200.79e1d9b1.jpg"},584:function(s,a,t){s.exports=t.p+"assets/img/20220120165228.e8fcd547.jpg"},585:function(s,a,t){s.exports=t.p+"assets/img/20220120165433.4c14226f.jpg"},586:function(s,a,t){s.exports=t.p+"assets/img/20220120170123.81393397.jpg"},587:function(s,a,t){s.exports=t.p+"assets/img/20220120170257.bd69a3a3.jpg"},588:function(s,a,t){s.exports=t.p+"assets/img/20220120173434.174c6286.jpg"},589:function(s,a,t){s.exports=t.p+"assets/img/20220126161603.e9c81981.jpg"},590:function(s,a,t){s.exports=t.p+"assets/img/20220120203750.b6a5ce95.jpg"},591:function(s,a,t){s.exports=t.p+"assets/img/20220126172937.051d7382.jpg"},592:function(s,a,t){s.exports=t.p+"assets/img/20220126163511.84f42ba0.jpg"},593:function(s,a,t){s.exports=t.p+"assets/img/20220126163613.75796775.jpg"},594:function(s,a,t){s.exports=t.p+"assets/img/20220125151408.b51f7785.jpg"},595:function(s,a,t){s.exports=t.p+"assets/img/20220125144219.2628e168.jpg"},596:function(s,a,t){s.exports=t.p+"assets/img/20220125150358.f8a30788.jpg"},597:function(s,a,t){s.exports=t.p+"assets/img/20220208162352.c18f828f.jpg"},598:function(s,a,t){s.exports=t.p+"assets/img/20220208154850.0c5bf06f.jpg"},599:function(s,a,t){s.exports=t.p+"assets/img/20220208154925.f2c8a2f4.jpg"},600:function(s,a,t){s.exports=t.p+"assets/img/20220208154954.e64eb6ab.jpg"},601:function(s,a,t){s.exports=t.p+"assets/img/20220208154740.c0cb0ba1.jpg"},602:function(s,a,t){s.exports=t.p+"assets/img/20220129214152.8799eed0.jpg"},603:function(s,a,t){s.exports=t.p+"assets/img/20220129214943.52dabc89.jpg"},604:function(s,a,t){s.exports=t.p+"assets/img/20220129214323.f308e28b.jpg"},678:function(s,a,t){"use strict";t.r(a);var n=t(7),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("官方文档：")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://www.jenkins.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.jenkins.io/"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://www.jenkins.io/zh/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.jenkins.io/zh/"),n("OutboundLink")],1)])]),s._v(" "),n("p",[s._v("下载地址：")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://www.jenkins.io/download/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.jenkins.io/download/"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"http://mirrors.jenkins-ci.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://mirrors.jenkins-ci.org/"),n("OutboundLink")],1)])]),s._v(" "),n("p",[s._v("下载插件：")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"http://mirrors.jenkins-ci.org/plugins/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://mirrors.jenkins-ci.org/plugins/"),n("OutboundLink")],1)])]),s._v(" "),n("h2",{attrs:{id:"在linux上部署jenkins"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#在linux上部署jenkins"}},[s._v("#")]),s._v(" 在Linux上部署Jenkins")]),s._v(" "),n("p",[s._v("第一次使用 Jenkins，您需要：")]),s._v(" "),n("p",[s._v("机器要求：")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("256 MB 内存，建议大于 512 MB")])]),s._v(" "),n("li",[n("strong",[s._v("10 GB 的硬盘空间")]),s._v("（用于 Jenkins 和 Docker 镜像）")])]),s._v(" "),n("p",[s._v("需要安装以下软件：")]),s._v(" "),n("ul",[n("li",[n("strong",[s._v("Java 8 ( JRE 或者 JDK 都可以)")])]),s._v(" "),n("li",[s._v("Docker （导航到网站顶部的Get Docker链接以访问适合您平台的Docker下载）")])]),s._v(" "),n("h3",{attrs:{id:"使用war部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用war部署"}},[s._v("#")]),s._v(" 使用war部署")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("下载jenkins.war，并上传到/usr/local")]),s._v(" "),n("p",[n("img",{attrs:{src:t(574),alt:""}})]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" /usr/local/ "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" jenkins*\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("运行jenkins")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用默认端口8080")]),s._v("\njava -jar /usr/local/jenkins.war\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定端口启动，防止被占用")]),s._v("\njava -jar /usr/local/jenkins.war --httpPort"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后台启动")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" java -jar /usr/local/jenkins.war --httpPort"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8888")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])])])]),s._v(" "),n("h3",{attrs:{id:"使用yum安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用yum安装"}},[s._v("#")]),s._v(" 使用yum安装")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("下载jenkins-2.319.2-1.1.noarch.rpm，并上传到/usr/local")]),s._v(" "),n("p",[n("img",{attrs:{src:t(575),alt:""}})]),s._v(" "),n("p",[n("img",{attrs:{src:t(576),alt:""}})])]),s._v(" "),n("li",[n("p",[s._v("安装Jenkins")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" epel-release "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# repository that provides 'daemonize'")]),s._v("\nyum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" jenkins-2.319.2-1.1.noarch.rpm -y\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("编辑jenkins的 /etc/init.d/jenkins 程序文件，添加java路径")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@jenkins2 ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# whereis java")]),s._v("\njava: /usr/local/jdk1.8.0_321/bin/java /usr/local/jdk1.8.0_321/jre/bin/java\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/init.d/jenkins\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("img",{attrs:{src:t(577),alt:""}})])]),s._v(" "),n("li",[n("p",[s._v("编辑jenkins的 /etc/sysconfig/jenkins 配置文件，修改端口、系统运行账户")]),s._v(" "),n("p",[s._v("jenkins默认情况是使用Jenkins用户启动的，但这个用户目前系统并没有赋予权限，这里我们将启动用户修改为root；另外Jenkins的默认端口是8080，这个跟tomcat的默认端口有冲突，可以做一下更改。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/sysconfig/jenkins\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("img",{attrs:{src:t(578),alt:""}})])]),s._v(" "),n("li",[n("p",[s._v("启动和停止Jenkins")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("systemctl daemon-reload                   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新加载配置")]),s._v("\nsystemctl start jenkins.service           "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动jenkins")]),s._v("\nsystemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" jenkins.service          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置jenkins开机启动 ")]),s._v("\nsystemctl stop jenkins.service            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭jenkins ")]),s._v("\nsystemctl status jenkins.service          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看jenkins状态")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])])])]),s._v(" "),n("h2",{attrs:{id:"首次使用jenkins"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#首次使用jenkins"}},[s._v("#")]),s._v(" 首次使用Jenkins")]),s._v(" "),n("h3",{attrs:{id:"第一次访问需要输入管理员密码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#第一次访问需要输入管理员密码"}},[s._v("#")]),s._v(" 第一次访问需要输入管理员密码"),n("img",{attrs:{src:t(579),alt:""}})]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /root/.jenkins/secrets/initialAdminPassword\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"跳过安装插件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#跳过安装插件"}},[s._v("#")]),s._v(" 跳过安装插件")]),s._v(" "),n("p",[s._v("自定义Jenkins -> 选择插件来安装 -> 无，Jenkins默认使用国外地址，安装很慢，此处先跳过"),n("img",{attrs:{src:t(580),alt:""}}),n("img",{attrs:{src:t(581),alt:""}})]),s._v(" "),n("h3",{attrs:{id:"创建第一个管理员用户"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建第一个管理员用户"}},[s._v("#")]),s._v(" 创建第一个管理员用户")]),s._v(" "),n("p",[s._v("Username: root")]),s._v(" "),n("p",[s._v("Password: 123456"),n("img",{attrs:{src:t(582),alt:""}})]),s._v(" "),n("h3",{attrs:{id:"修改插件下载地址"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#修改插件下载地址"}},[s._v("#")]),s._v(" 修改插件下载地址")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("Jenkins -> Manage Jenkins -> Manage Plugins，点击Available，把Jenkins官方的插件列表下载到本地，接着修改地址文件，替换为国内插件下载地址。")])]),s._v(" "),n("li",[n("p",[s._v("将 /var/lib/jenkins/updates/default.json 的国外地址替换为国内地址。")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /var/lib/jenkins/updates\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 备份")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" default.json default.json.bak\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 替换为国内插件下载地址")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/http:\\/\\/updates.jenkinci.org\\/download/https:\\/\\/mirrors.tuna.tsinghua.edu.cn\\/jenkins/g'")]),s._v(" default.json "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/http:\\/\\/www.google.com/https:\\/\\/www.baidu.com/g'")]),s._v(" default.json\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("Jenkins -> Manage Jenkins -> Manage Plugins，点击Advanced，把Update Site改为国内插件下载地址。")]),s._v(" "),n("p",[s._v("官方插件下载地址：https://updates.jenkins.io/update-center.json")]),s._v(" "),n("p",[s._v("国内插件下载地址：https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json")]),s._v(" "),n("p",[s._v("Sumbit后，在浏览器输入： http://192.168.1.16:8888/restart ，重启Jenkins")])])]),s._v(" "),n("h2",{attrs:{id:"jenkins插件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jenkins插件"}},[s._v("#")]),s._v(" Jenkins插件")]),s._v(" "),n("h3",{attrs:{id:"role-based-authorization-strategy"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#role-based-authorization-strategy"}},[s._v("#")]),s._v(" Role-based Authorization Strategy")]),s._v(" "),n("p",[s._v("Jenkins默认用户权限粒度不够细，可以使用Role-based Authorization Strategy插件来管理Jenkins用户权限。")]),s._v(" "),n("p",[s._v("Jenkins -> Manage Jenkins -> Manage Plugins，搜索Role-based Authorization Strategy，点击Download now and install after restart")]),s._v(" "),n("p",[n("img",{attrs:{src:t(583),alt:""}})]),s._v(" "),n("p",[s._v('Jenkins -> Manage Jenkins -> Configure Global Security，授权策略切换为"Role-Based Strategy"，保存')]),s._v(" "),n("p",[n("img",{attrs:{src:t(584),alt:""}})]),s._v(" "),n("h4",{attrs:{id:"创建角色"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建角色"}},[s._v("#")]),s._v(" 创建角色")]),s._v(" "),n("p",[s._v("Jenkins -> Manage Jenkins -> Manage and Assign Roles")]),s._v(" "),n("p",[n("img",{attrs:{src:t(585),alt:""}})]),s._v(" "),n("p",[n("img",{attrs:{src:t(586),alt:""}})]),s._v(" "),n("h4",{attrs:{id:"创建用户"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建用户"}},[s._v("#")]),s._v(" 创建用户")]),s._v(" "),n("p",[s._v("Jenkins -> Manage Jenkins -> Manage Users")]),s._v(" "),n("p",[n("img",{attrs:{src:t(587),alt:""}})]),s._v(" "),n("h4",{attrs:{id:"用户授权"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#用户授权"}},[s._v("#")]),s._v(" 用户授权")]),s._v(" "),n("p",[s._v("Jenkins -> Manage Jenkins -> Manage and Assign Roles -> Assign Roles")]),s._v(" "),n("h3",{attrs:{id:"credentials-binding"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#credentials-binding"}},[s._v("#")]),s._v(" Credentials Binding")]),s._v(" "),n("p",[s._v("凭据可以用来存储需要密文保护的数据库密码、Gitlab密码信息、Docker私有仓库密码等，以便\nJenkins可以和这些第三方的应用进行交互。")]),s._v(" "),n("p",[s._v("要在Jenkins使用凭证管理功能，需要安装Credentials Binding插件。")]),s._v(" "),n("p",[s._v("在 Jenkins -> Manage Jenkins -> Manage Credentials 管理凭据。")]),s._v(" "),n("p",[n("img",{attrs:{src:t(588),alt:""}})]),s._v(" "),n("h3",{attrs:{id:"git"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#git"}},[s._v("#")]),s._v(" Git")]),s._v(" "),n("p",[s._v("为了让Jenkins支持从Gitlab拉取源码，需要"),n("strong",[s._v("在Jenkins上安装Git插件")]),s._v("以及"),n("strong",[s._v("在CentOS7上安装Git工具")]),s._v("。")]),s._v(" "),n("ol",[n("li",[s._v("在CentOS7上安装Git工具")])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[s._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" -y\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" --version\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ol",{attrs:{start:"2"}},[n("li",[n("p",[s._v("在 Jenkins -> Manage Jenkins -> Manage Plugins 搜索 Git 插件并安装。")]),s._v(" "),n("p",[n("img",{attrs:{src:t(589),alt:""}})])]),s._v(" "),n("li",[n("p",[s._v("在 Jenkins -> Manage Jenkins -> Global Tool Configuration 中配置Git路径")])])]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@jenkins2 updates"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# whereis git")]),s._v("\ngit: /usr/bin/git /usr/share/man/man1/git.1.gz\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("img",{staticStyle:{zoom:"25%"},attrs:{src:t(590)}}),s._v(" "),n("h3",{attrs:{id:"maven"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#maven"}},[s._v("#")]),s._v(" Maven")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("在Jenkins服务器中安装Maven，见"),n("RouterLink",{attrs:{to:"/article/devops/maven.html"}},[s._v("Maven学习笔记")])],1)]),s._v(" "),n("li",[n("p",[s._v("在Jenkins管理后台安装Maven插件")]),s._v(" "),n("p",[n("img",{attrs:{src:t(591),alt:""}})])])]),s._v(" "),n("h3",{attrs:{id:"maven-integration"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#maven-integration"}},[s._v("#")]),s._v(" Maven Integration")]),s._v(" "),n("p",[n("img",{attrs:{src:t(592),alt:""}})]),s._v(" "),n("p",[s._v("参考 "),n("a",{attrs:{href:"https://www.cnblogs.com/laoayi/p/12868155.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.cnblogs.com/laoayi/p/12868155.html"),n("OutboundLink")],1)]),s._v(" "),n("h3",{attrs:{id:"pipeline"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#pipeline"}},[s._v("#")]),s._v(" Pipeline")]),s._v(" "),n("p",[n("img",{attrs:{src:t(593),alt:""}})]),s._v(" "),n("p",[n("img",{attrs:{src:t(594),alt:""}})]),s._v(" "),n("h3",{attrs:{id:"ssh"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ssh"}},[s._v("#")]),s._v(" SSH")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("搜索SSH")])]),s._v(" "),n("li",[n("p",[s._v("在 Jenkins -> Manage Jenkins -> Manage Credentials 添加凭据")])]),s._v(" "),n("li",[n("p",[s._v("在 Manage Jenkins -> Configure System 添加远程服务器")])])]),s._v(" "),n("p",[n("img",{attrs:{src:t(595),alt:""}})]),s._v(" "),n("ol",{attrs:{start:"4"}},[n("li",[s._v("测试")])]),s._v(" "),n("p",[n("img",{attrs:{src:t(596),alt:""}})]),s._v(" "),n("h3",{attrs:{id:"ssh-pipeline-steps"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ssh-pipeline-steps"}},[s._v("#")]),s._v(" SSH Pipeline Steps")]),s._v(" "),n("p",[n("img",{attrs:{src:t(597),alt:""}})]),s._v(" "),n("h2",{attrs:{id:"jenkins配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jenkins配置"}},[s._v("#")]),s._v(" Jenkins配置")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("进入 Manage Jenkins -> Global Tool Configuration")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("配置JDK")]),s._v(" "),n("p",[n("img",{attrs:{src:t(598),alt:""}})])]),s._v(" "),n("li",[n("p",[s._v("配置Git")]),s._v(" "),n("p",[n("img",{attrs:{src:t(599),alt:""}})])]),s._v(" "),n("li",[n("p",[s._v("配置Maven")]),s._v(" "),n("p",[n("img",{attrs:{src:t(600),alt:""}})])])])]),s._v(" "),n("li",[n("p",[s._v("进入 Manage Jenkins -> Configure System -> Global Properties")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("配置JAVA_HOME，JAVA_HOME=/usr/local/jdk1.8.0_321")])]),s._v(" "),n("li",[n("p",[s._v("配置M2_HOME，M2_HOME=/usr/local/apache-maven-3.8.4")])]),s._v(" "),n("li",[n("p",[s._v("配置PATH+EXTRA，PATH+EXTRA=$M2_HOME/bin")]),s._v(" "),n("p",[n("img",{attrs:{src:t(601),alt:""}})])])])]),s._v(" "),n("li",[n("p",[s._v("Jenkins服务器访问GitLab服务器")]),s._v(" "),n("p",[s._v("在 Jenkins服务器添加域名映射")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/hosts\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.13 gitlab.example.com\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])])])]),s._v(" "),n("h2",{attrs:{id:"部署项目"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#部署项目"}},[s._v("#")]),s._v(" 部署项目")]),s._v(" "),n("h3",{attrs:{id:"jenkinsfile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jenkinsfile"}},[s._v("#")]),s._v(" Jenkinsfile")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://www.jenkins.io/zh/doc/book/pipeline/jenkinsfile/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://www.jenkins.io/zh/doc/book/pipeline/jenkinsfile/"),n("OutboundLink")],1)]),s._v(" "),n("div",{staticClass:"language-groovy line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-groovy"}},[n("code",[s._v("pipeline "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    agent any\n\n    environment "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        ACTION "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("action"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),s._v("\n        ROLLBACK_VERSION "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("rollbackVersion"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),s._v("\n        DEPLOY_ONLY "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"deploy only"')]),s._v("\n        BACKUP_AND_DEPLOY "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"backup and deploy"')]),s._v("\n        ROLLBACK "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"rollback"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    options "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Pipeline Stage View 不显示 Declarative: Checkout SCM")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("skipDefaultCheckout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    stages "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Pull project'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                script "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ACTION "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("DEPLOY_ONLY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" ACTION "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("BACKUP_AND_DEPLOY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("checkout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'GitSCM'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" branches"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"*/'),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("branch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" extensions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" userRemoteConfigs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("credentialsId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'e8dd0227-84f1-4158-aaac-846185848fcf'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" url"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'git@gitlab.example.com:uuap/uuap-api.git'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Build project'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                script "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ACTION "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("DEPLOY_ONLY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" ACTION "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("BACKUP_AND_DEPLOY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        sh "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mvn clean package'")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Publish project'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                script "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ACTION "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("DEPLOY_ONLY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" ACTION "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("BACKUP_AND_DEPLOY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        sh "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'scp target/*.jar root@192.168.1.17:/opt/webapp/uuap-api-ssh'")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("stage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Start project'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            environment "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                WORKSPACE_PATH "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/opt/webapp'")]),s._v("\n                PROJECT_NAME "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'uuap-api-ssh'")]),s._v("\n                LOG_FILE_PATH "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("WORKSPACE_PATH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v("/"),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("PROJECT_NAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('/log.log"')]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                script "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" remote "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n                    remote"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("name "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'applicationServer'")]),s._v("\n                    remote"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("host "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'192.168.1.17'")]),s._v("\n                    remote"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("allowAnyHosts "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\n                    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("withCredentials")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("usernamePassword")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("credentialsId"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1572b106-87a0-4be9-955d-afcba791d9a4'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" passwordVariable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'password'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" usernameVariable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'userName'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                        remote"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("user "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" userName\n                        remote"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("password "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" password\n\n                        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ACTION "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("BACKUP_AND_DEPLOY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            sshCommand remote"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" remote"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" command"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"""\n                                cd '),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("WORKSPACE_PATH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v("/"),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("PROJECT_NAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v("/scripts\n                                ./backup.sh "),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("BUILD_NUMBER"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('\n                            """')]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n                        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ACTION "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("ROLLBACK"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                            sshCommand remote"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" remote"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" command"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"""\n                                cd '),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("WORKSPACE_PATH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v("/"),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("PROJECT_NAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v("/scripts\n                                ./rollback.sh "),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("ROLLBACK_VERSION"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('\n                            """')]),s._v("\n                        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n                        sshCommand remote"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" remote"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" command"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"""\n                                cd '),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("WORKSPACE_PATH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v("/"),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("PROJECT_NAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v("/scripts\n                                ./stop.sh "),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("ACTION"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('\n                            """')]),s._v("\n\n                        sshCommand remote"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" remote"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" command"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string gstring"}},[s._v('"""\n                                cd '),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("WORKSPACE_PATH"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v("/"),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("PROJECT_NAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v("/scripts\n                                ./start.sh "),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("$")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("ACTION"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")])]),s._v('\n                            """')]),s._v("\n                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br")])]),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使脚本具有执行权限")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x ./start.sh\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x ./stop.sh\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x ./backup.sh\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x ./rollback.sh\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行脚本")]),s._v("\n./start.sh  \n./stop.sh \n./backup.sh\n./rollback.sh\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h3",{attrs:{id:"start-sh"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#start-sh"}},[s._v("#")]),s._v(" start.sh")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_PATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/jdk1.8.0_321/bin/java\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PROJECT_PATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/webapp/uuap-api-ssh\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LOG_FILE_PATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PROJECT_PATH}")]),s._v("/log.log\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("file_name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"uuap-api.jar"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("action")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DEPLOY_ONLY")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deploy only"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BACKUP_AND_DEPLOY")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"backup and deploy"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ROLLBACK")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rollback"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rollbackResult")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rollbackResult_path")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${workspace_directory}")]),s._v("/rollbackResult.txt\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${rollbackResult_path}")]),s._v("/ "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" line\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rollbackResult")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$line")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rollbackResult='),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${rollbackResult}")]),s._v('"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PROJECT_PATH}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${action}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${DEPLOY_ONLY}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${action}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BACKUP_AND_DEPLOY}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${action}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ROLLBACK}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${rollbackResult}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_PATH}")]),s._v(" -jar uuap-api.jar "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" log.log "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -f "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LOG_FILE_PATH}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" line \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" \n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$line")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("is_startup")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" $line"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Started WebApplication"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" -l"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$is_startup")]),s._v(" -eq "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("  \n            "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -9 "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" axu"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tail -f '),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${LOG_FILE_PATH}")]),s._v('"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -v "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"grep"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{printf $2}'")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\t\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br")])]),n("h3",{attrs:{id:"stop-sh"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#stop-sh"}},[s._v("#")]),s._v(" stop.sh")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("action")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DEPLOY_ONLY")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"deploy only"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BACKUP_AND_DEPLOY")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"backup and deploy"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ROLLBACK")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rollback"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rollbackResult")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rollbackResult_path")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${workspace_directory}")]),s._v("/rollbackResult.txt\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${rollbackResult_path}")]),s._v("/ "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" line\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rollbackResult")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$line")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rollbackResult='),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${rollbackResult}")]),s._v('"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pid")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" uuap-api.jar "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" -v "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $2}'")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -n "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$pid")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v(' "${action}" '),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(' "${DEPLOY_ONLY}" '),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(' "${action}" '),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(' "${BACKUP_AND_DEPLOY}" '),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(' "${action}" '),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(' "${ROLLBACK}" '),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(' "${rollbackResult}" '),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(' "true" '),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -9 "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$pid")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("h3",{attrs:{id:"backup-sh"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#backup-sh"}},[s._v("#")]),s._v(" backup.sh")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BUILD_NUMBER")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("workspace_directory")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/webapp/uuap-api-ssh"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("backup_directory")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/webapp_backup/uuap-api-ssh/'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${BUILD_NUMBER}")]),s._v('"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("file_name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"uuap-api.jar"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果备份目录不存在，则创建")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" -d "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${backup_directory}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${backup_directory}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将当前构建文件拷贝到备份目录中")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -f "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${workspace_directory}")]),s._v("/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${file_name}")]),s._v('"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${workspace_directory}")]),s._v("/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${file_name}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${backup_directory}")]),s._v("/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${file_name}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("h3",{attrs:{id:"rollback-sh"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#rollback-sh"}},[s._v("#")]),s._v(" rollback.sh")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rollbackVersion")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("workspace_directory")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/webapp/uuap-api-ssh"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("backup_directory")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/webapp_backup/uuap-api-ssh/'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${rollbackVersion}")]),s._v('"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("file_name")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"uuap-api.jar"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rollbackResult_path")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${workspace_directory}")]),s._v("/rollbackResult.txt\n\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${workspace_directory}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" -d "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${backup_directory}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf uuap-api.jar log.log\n\t"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${backup_directory}")]),s._v("/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${file_name}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${workspace_directory}")]),s._v("/"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${file_name}")]),s._v(" \n\t"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${rollbackResult_path}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" \n\t"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"rollback version '"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${rollbackVersion}")]),s._v("' is not exist.\"")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"false"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("tee")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${rollbackResult_path}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])]),n("h3",{attrs:{id:"参数化构建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参数化构建"}},[s._v("#")]),s._v(" 参数化构建")]),s._v(" "),n("p",[n("img",{attrs:{src:t(602),alt:""}})]),s._v(" "),n("p",[n("img",{attrs:{src:t(603),alt:""}})]),s._v(" "),n("p",[n("img",{attrs:{src:t(604),alt:""}})]),s._v(" "),n("h2",{attrs:{id:"部署问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#部署问题"}},[s._v("#")]),s._v(" 部署问题")]),s._v(" "),n("h3",{attrs:{id:"nohup-failed-to-run-command-java-no-such-file-or-directory"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nohup-failed-to-run-command-java-no-such-file-or-directory"}},[s._v("#")]),s._v(" nohup: failed to run command ‘java’: No such file or directory")]),s._v(" "),n("p",[s._v("解决方案一：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /etc/profile\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" java -jar uuap-api.jar "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" log.log "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("解决方案二：")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_PATH")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/jdk1.8.0_321/bin/java\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_PATH}")]),s._v(" -jar uuap-api.jar "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" log.log "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("h2",{attrs:{id:"参考资料"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),n("p",[n("a",{attrs:{href:"https://www.bilibili.com/video/BV1kJ411p7mV",target:"_blank",rel:"noopener noreferrer"}},[s._v("黑马程序员Java教程自动化部署Jenkins从环境配置到项目开发"),n("OutboundLink")],1)]),s._v(" "),n("p",[n("a",{attrs:{href:"Jenkins持续集成从入门到精通"}},[s._v("Jenkins持续集成从入门到精通")])]),s._v(" "),n("p",[n("a",{attrs:{href:"https://www.cnblogs.com/zsh-blogs/p/10508656.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("使用Jenkins构建、部署spring boot项目"),n("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=e.exports}}]);